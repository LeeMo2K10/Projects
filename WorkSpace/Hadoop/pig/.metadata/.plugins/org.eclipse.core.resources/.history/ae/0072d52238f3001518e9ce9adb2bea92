package com.myudfs;

import org.apache.pig.data.Tuple;
import org.apache.pig.data.TupleFactory;

public class COUNT extends EvalFunc<Long> implements Algebraic {
	private static TupleFactory mTupleFactory = TupleFactory.getInstance();

	@Override
	public Long exec(Tuple input) throws IOException {
		try {
			DataBag bag = (DataBag) input.get(0);
			if (bag == null)
				return null;

			Iterator it = bag.iterator();
			long cnt = 0;
			while (it.hasNext()) {
				Tuple t = (Tuple) it.next();
				if (t != null && t.size() > 0 && t.get(0) != null)
					cnt++;
			}
			return cnt;
		} catch (ExecException ee) {
			throw ee;
		} catch (Exception e) {
			int errCode = 2106;
			String msg = "Error while computing count in " + this.getClass().getSimpleName();
			throw new ExecException(msg, errCode, PigException.BUG, e);
		}
	}

}

package com.smooks.smooks_CsvToXml;

import java.io.ByteArrayInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.StringWriter;

import javax.xml.transform.stream.StreamResult;
import javax.xml.transform.stream.StreamSource;

import org.milyn.Smooks;
import org.milyn.SmooksException;
import org.milyn.container.ExecutionContext;
import org.milyn.event.report.HtmlReportGenerator;
import org.milyn.io.StreamUtils;
import org.xml.sax.SAXException;

public class SmooksTransformation {
	private static byte[] messageIn = readInputMessage();

	private static byte[] readInputMessage() {
		try {
			return StreamUtils.readStream(new FileInputStream("src/main/resources/input.csv"));
		} catch (IOException e) {
			e.printStackTrace();
			return "<no-message/>".getBytes();
		}
	}

	protected static void csvToXml() throws IOException, SAXException, SmooksException {

		Smooks smooks = new Smooks("smooks-config.xml");

		try {
			ExecutionContext executionContext = smooks.createExecutionContext();
			FileOutputStream fout = new FileOutputStream("src/main/resources/output.xml");
			smooks.filterSource(executionContext,
					new StreamSource(new InputStreamReader(new ByteArrayInputStream(messageIn), "UTF-8")),
					new StreamResult(fout));
		} finally {
			smooks.close();
		}
	}

	public static void main(String[] args) throws IOException, SAXException, SmooksException {

		SmooksTransformation transform = new SmooksTransformation();
		transform.csvToXml();

	}

}
